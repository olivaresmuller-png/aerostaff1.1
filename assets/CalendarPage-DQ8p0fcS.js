import{c as Ze,t as Je,a as ls,b as Ce,s as ws,r as d,u as Ps,j as e,D as Ue,d as He,B as T,e as ze,f as Ke,g as Ye,h as Js,U as Xs,T as is,i as Qs,k as j,S as qe,l as C,C as Rs,G as cs,P as et,m as Fs,n as $s,o as Vs,p as st,q as Ss,v as tt,w as ee,x as ye,I as Cs,y as Ms,z as se,A as Ge,E as nt,F as at,H as ts,J as ns,K as rt,L as lt,M as it}from"./index-DN_tl9O8.js";import{F as ks,r as ct,u as dt,l as ot,S as xt,U as Es}from"./xlsx-fULH74Wb.js";import{S as Ae}from"./scroll-area-CzB3nQpX.js";import{B as L,L as Ne}from"./label-DEeaHMX_.js";import{C as Ts,a as Oe,s as mt}from"./setWeek-CIM7IQjS.js";import{S as ne,a as ae,b as re,c as ve,d as we,e as S,f as ie}from"./select-B0tBizsK.js";import{T as ht,a as ut,b as as,P as ft,c as Ds,d as Os,e as We,f as ce,g as As,h as de}from"./table-3MnZ9TJw.js";import"./index-DsnmE8Bx.js";/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M14 2v2",key:"6buw04"}],["path",{d:"M16 8a1 1 0 0 1 1 1v8a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4V9a1 1 0 0 1 1-1h14a4 4 0 1 1 0 8h-1",key:"pwadti"}],["path",{d:"M6 2v2",key:"colzsn"}]],gt=Ze("coffee",pt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jt=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],bt=Ze("heart",jt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yt=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],Bs=Ze("loader-circle",yt);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Nt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],vt=Ze("shield",Nt);function Gs(r,n){const i=Je(r);if(isNaN(n))return ls(r,NaN);if(!n)return i;const u=i.getDate(),y=ls(r,i.getTime());y.setMonth(i.getMonth()+n+1,0);const m=y.getDate();return u>=m?y:(i.setFullYear(y.getFullYear(),y.getMonth(),u),i)}function Ws(r,n){const i=n*7;return Ce(r,i)}function wt(r){return ls(r,Date.now())}function St(r,n){const i=ws(r),u=ws(n);return+i==+u}function Ct(r){const n=Je(r),i=n.getMonth();return n.setFullYear(n.getFullYear(),i+1,0),n.setHours(23,59,59,999),n}function Mt(r){const n=Je(r);return n.setDate(1),n.setHours(0,0,0,0),n}function ds(r){return Je(r).getDay()}function Me(r){return St(r,wt(r))}function kt(r,n){return Gs(r,-1)}function Et(r,n){return Ws(r,-1)}const Is={jan:0,feb:1,mar:2,mär:2,apr:3,may:4,mai:4,jun:5,jul:6,aug:7,sep:8,oct:9,okt:9,nov:10,dec:11,dez:11};function Tt(){const[r,n]=d.useState(!1),[i,u]=d.useState(!1),[y,m]=d.useState(!1),[o,t]=d.useState(null),[D,P]=d.useState(null),R=d.useRef(null),{employees:pe,updateAssignment:F}=Ps(),xe=N=>{const v=N.join(" ").toLowerCase();for(const[q,O]of Object.entries(Is))if(v.includes(q))return O;return new Date().getMonth()},xs=async N=>{u(!0),P(null),t(null);try{const v=await N.arrayBuffer(),q=ct(v,{type:"array"}),O=q.SheetNames[0],Ie=q.Sheets[O],B=dt.sheet_to_json(Ie,{header:1,defval:""});if(B.length<8)throw new Error("Excel file does not have enough rows. Expected at least 8 rows.");const Le=B[4]||[],Z=B[5]||[],hs=B[6]||[],le=xe(Le);let Ee=new Date().getFullYear();for(let M=0;M<Math.min(5,B.length);M++){const b=B[M].join(" ").match(/20\d{2}/);if(b){Ee=parseInt(b[0]);break}}const ge=[];for(let M=3;M<Z.length;M++){const G=Z[M];if(!G)continue;const b=String(G).trim(),f=parseInt(b,10);if(isNaN(f)||f<1||f>31)continue;let W=le;const J=String(Le[M]||"").toLowerCase();for(const[he,Te]of Object.entries(Is))if(J.includes(he)){W=Te;break}let $=Ee;W<le&&le>=10&&W<=2&&($=Ee+1);const H=new Date($,W,f);isNaN(H.getTime())||ge.push({col:M,dateStr:j(H,"yyyy-MM-dd")})}if(ge.length===0)throw new Error("Could not find valid dates in row 6. Make sure day numbers (1-31) are in row 6 starting from column D.");const me=[],Pe=new Set,Xe=7;for(let M=Xe;M<B.length;M++){const G=B[M];if(!G||G.length<4)continue;const b=G[2];if(!b)continue;const f=String(b).trim().toUpperCase();if(f.length<2||f.length>6||/\d/.test(f)||f.includes("(")||f.includes("ENGINEER")||f.includes("MANAGER")||f.includes("SUPERVISOR")||f.includes("PRODUCTION")||f.includes("HEAD")||f.includes("TMB")||f.includes("EMPLOYEE")||f.includes("SENIOR")||f.includes("EXTERNAL")||f.includes("CODE")||f.includes("3/4"))continue;if(!pe.find(J=>J.initials.toUpperCase()===f)){f.match(/^[A-Z]{3,5}$/)&&Pe.add(f);continue}for(const J of ge){const $=G[J.col];if(!$)continue;const H=String($).trim();!H||H==="-"||H===""||me.push({employeeInitials:f,date:J.dateStr,shiftCode:H})}}const je=ge.map(M=>M.dateStr).sort(),Qe=je.length>0?{start:je[0],end:je[je.length-1]}:null;t({total:me.length,matched:new Set(me.map(M=>M.employeeInitials)).size,unmatched:Array.from(Pe),shifts:me,dateRange:Qe})}catch(v){P(v instanceof Error?v.message:"Failed to parse Excel file")}finally{u(!1)}},ms=async()=>{if(o){m(!0);try{for(const N of o.shifts){const v=pe.find(q=>q.initials.toUpperCase()===N.employeeInitials);v&&F(N.date,v.id,N.shiftCode)}n(!1),t(null)}finally{m(!1)}}},Be=N=>{const v=N.target.files?.[0];v&&xs(v),R.current&&(R.current.value="")},ke=()=>{n(!1),t(null),P(null)};return e.jsxs(Ue,{open:r,onOpenChange:N=>N?n(!0):ke(),children:[e.jsx(He,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:"gap-2","data-testid":"button-import-excel",children:[e.jsx(ks,{className:"w-4 h-4"}),"Import Excel"]})}),e.jsxs(ze,{className:"max-w-lg",children:[e.jsxs(Ke,{children:[e.jsxs(Ye,{className:"flex items-center gap-2",children:[e.jsx(ks,{className:"w-5 h-5"}),"Import Shift Schedule from Excel"]}),e.jsx(Js,{children:"Upload Excel file with shifts. Format: Row 5 = Month, Row 6 = Day, Row 7 = Weekday, Column C = Employee code, Column D+ = Shifts"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{ref:R,type:"file",accept:".xlsx,.xls",onChange:Be,className:"hidden"}),e.jsx(T,{onClick:()=>R.current?.click(),disabled:i,className:"w-full gap-2",variant:"outline",children:i?e.jsxs(e.Fragment,{children:[e.jsx(Bs,{className:"w-4 h-4 animate-spin"}),"Parsing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Xs,{className:"w-4 h-4"}),"Select Excel File"]})}),D&&e.jsxs("div",{className:"p-3 bg-destructive/10 text-destructive rounded-lg flex items-start gap-2",children:[e.jsx(is,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{className:"text-sm",children:D})]}),o&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-4 bg-muted/50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-green-600",children:[e.jsx(Ts,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"File parsed successfully"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Shifts found:"}),e.jsx("span",{className:"ml-2 font-medium",children:o.total})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Employees matched:"}),e.jsx("span",{className:"ml-2 font-medium",children:o.matched})]})]}),o.dateRange&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Date range:"}),e.jsxs("span",{className:"ml-2 font-medium",children:[o.dateRange.start," to ",o.dateRange.end]})]})]}),o.unmatched.length>0&&e.jsxs("div",{className:"p-3 bg-yellow-500/10 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 text-yellow-600 mb-2",children:[e.jsx(is,{className:"w-4 h-4"}),e.jsxs("span",{className:"text-sm font-medium",children:["Unmatched employees (",o.unmatched.length,")"]})]}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[o.unmatched.slice(0,10).map(N=>e.jsx(L,{variant:"outline",className:"text-xs",children:N},N)),o.unmatched.length>10&&e.jsxs(L,{variant:"outline",className:"text-xs",children:["+",o.unmatched.length-10," more"]})]})]}),o.shifts.length>0&&e.jsx(Ae,{className:"h-[150px] border rounded-lg",children:e.jsxs("div",{className:"p-2 space-y-1",children:[o.shifts.slice(0,50).map((N,v)=>e.jsxs("div",{className:"flex justify-between text-xs px-2 py-1 hover:bg-muted/50 rounded",children:[e.jsx("span",{className:"font-mono",children:N.employeeInitials}),e.jsx("span",{className:"text-muted-foreground",children:N.date}),e.jsx(L,{variant:"secondary",className:"text-xs",children:N.shiftCode})]},v)),o.shifts.length>50&&e.jsxs("div",{className:"text-center text-xs text-muted-foreground py-2",children:["... and ",o.shifts.length-50," more shifts"]})]})})]})]}),e.jsxs(Qs,{children:[e.jsx(T,{variant:"outline",onClick:ke,children:"Cancel"}),e.jsx(T,{onClick:ms,disabled:!o||o.total===0||y,className:"gap-2",children:y?e.jsxs(e.Fragment,{children:[e.jsx(Bs,{className:"w-4 h-4 animate-spin"}),"Importing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ts,{className:"w-4 h-4"}),"Import ",o?.total||0," Shifts"]})})]})]})]})}const oe=d.memo(function({code:n,size:i="md",showLabel:u=!1}){const y=qe.find(t=>t.code===n),m=()=>n==="Ea"||n==="e"?"shift-early":n==="La"||n==="AL"?"shift-late":n==="Ae"||n==="eA"?"bg-amber-100 text-amber-700 dark:bg-amber-900/30 dark:text-amber-400":n==="V"?"shift-vacation":n==="T"||n==="TD"?"shift-training":n==="S"?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"shift-off",o={xs:"text-[8px] px-1 py-0 min-w-[20px]",sm:"text-[10px] px-1.5 py-0.5 min-w-[28px]",md:"text-xs px-2 py-1 min-w-[36px]",lg:"text-sm px-3 py-1.5 min-w-[48px]"};return e.jsxs("span",{"data-testid":`badge-shift-${n}`,className:C("inline-flex items-center justify-center font-mono font-semibold rounded-md transition-colors",m(),o[i]),children:[n,u&&y&&e.jsx("span",{className:"ml-1.5 font-sans font-normal opacity-75",children:y.label})]})}),Dt=["Ea","La","M","Ae","AL","e","eA","l","LA","TD","HO","t4"],Ot=["FT","BT","ET","FD","SI","SE","Sn","TR"],At=["V","PW","PC","PB","PD","PG","PI","PH","PM","PL","UL","KO","KB","FL"],Bt=["S","IC","IW","AC","AW"],It=["MC","MW"],Lt=["-","OFF","T","?"],Se={Ea:"06:15–15:09 • TMB Earlyshift",La:"14:00–22:54 • TMB Lateshift",M:"08:00–17:20 • TMB Mid-shift",Ae:"05:45–14:39 • TMB PL STV Early",AL:"13:30–22:24 • TMB PL STV Late",e:"TMB Earlyshift PM",eA:"05:45–14:39 • TMB PL Early",l:"TMB Lateshift PM",LA:"13:30–22:24 • TMB PL Late",TD:"Part Time Day shift",t4:"Classroom Training 4H",FT:"Feiertag / Public CH",BT:"Business Trip",SI:"School internal",SE:"School external",Sn:"School night",V:"Vacation",PW:"Wedding (own) - 3 Days",PB:"Birth - 2 Days",PD:"Death (Spouse/Child/Parents) - 3 Days",UL:"Unpaid Leave",KO:"Kompensation ex Overtime",KB:"Kompensation ex Timebonus",S:"Sick with Certificate",IC:"Sick with Certificate",IW:"Sick without Certificate",IB:"Baby Leave with Certificate",IM:"Baby Leave",IN:"Nurse of close relatives",AC:"Accident with Certificate",AW:"Accident without Certificate",MC:"Military with EO",MW:"Military without EO",FL:"Kompensation ex Flextime",HO:"Home Office",ET:"Educational Trip",FD:"Flight Duty",OF:"Office Duty",PR:"Projects",PC:"Wedding (Child) - 1 Day",PG:"Death (In-Law/Grandp.) - 2 Days",PI:"Death (In-Law/Sibling) - 1 Day",PH:"Moving HB >100km - 2 Days",PM:"Moving - 1 Day",PL:"Paid Leave",PK:"Baby Leave (Mutterschaftsurl)",ST:"Study Time",TO:"Time out",TR:"08:00–17:00 • Training","-":"Off day",OFF:"Scheduled off duty",T:"Training day","?":"Unassigned / TBD"},os=d.memo(function({value:n,onValueChange:i,compact:u,"data-testid":y}){const m=qe.find(t=>t.code===n),o=t=>qe.filter(D=>t.includes(D.code));return e.jsxs(ne,{value:n,onValueChange:t=>i(t),children:[e.jsxs(ae,{className:C("gap-2 border-2 hover:border-primary/50 transition-colors",u?"w-auto h-8 px-2":"w-auto"),"data-testid":y,children:[e.jsx(oe,{code:n,size:"sm"}),!u&&m&&m.hours>0&&e.jsxs("span",{className:"text-xs text-muted-foreground font-medium",children:[m.hours,"h"]})]}),e.jsxs(re,{className:"w-[340px] max-h-[450px]",children:[e.jsxs(ve,{children:[e.jsxs(we,{className:"flex items-center gap-2 text-primary font-semibold py-2",children:[e.jsx(Rs,{className:"w-4 h-4"}),"Work Shifts"]}),o(Dt).map(t=>e.jsx(S,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-primary/5",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(oe,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsxs("span",{className:"text-xs text-emerald-600 font-bold bg-emerald-50 px-1.5 py-0.5 rounded ml-2",children:[t.hours,"h"]})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Se[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs(ve,{children:[e.jsxs(we,{className:"flex items-center gap-2 text-blue-600 font-semibold py-2",children:[e.jsx(cs,{className:"w-4 h-4"}),"Training & Business"]}),o(Ot).map(t=>e.jsx(S,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-blue-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(oe,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),t.hours>0&&e.jsxs("span",{className:"text-xs text-blue-600 font-bold bg-blue-50 px-1.5 py-0.5 rounded ml-2",children:[t.hours,"h"]})]}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Se[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs(ve,{children:[e.jsxs(we,{className:"flex items-center gap-2 text-amber-600 font-semibold py-2",children:[e.jsx(et,{className:"w-4 h-4"}),"Leave & Time Off"]}),o(At).map(t=>e.jsx(S,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-amber-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(oe,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Se[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs(ve,{children:[e.jsxs(we,{className:"flex items-center gap-2 text-rose-600 font-semibold py-2",children:[e.jsx(bt,{className:"w-4 h-4"}),"Sick Leave"]}),o(Bt).map(t=>e.jsx(S,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-rose-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(oe,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Se[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs(ve,{children:[e.jsxs(we,{className:"flex items-center gap-2 text-indigo-600 font-semibold py-2",children:[e.jsx(vt,{className:"w-4 h-4"}),"Military Service"]}),o(It).map(t=>e.jsx(S,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-indigo-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(oe,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Se[t.code]})]})]})},t.code))]}),e.jsx("div",{className:"h-px bg-border my-2"}),e.jsxs(ve,{children:[e.jsxs(we,{className:"flex items-center gap-2 text-slate-500 font-semibold py-2",children:[e.jsx(gt,{className:"w-4 h-4"}),"Off Duty"]}),o(Lt).map(t=>e.jsx(S,{value:t.code,className:"py-2.5 cursor-pointer hover:bg-slate-50",children:e.jsxs("div",{className:"flex items-start gap-3 w-full",children:[e.jsx(oe,{code:t.code,size:"sm"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("span",{className:"text-sm font-semibold",children:t.label}),e.jsx("p",{className:"text-[11px] text-muted-foreground mt-0.5 leading-tight",children:Se[t.code]})]})]})},t.code))]})]})]})}),Pt=d.memo(function({employees:n,weekDates:i,getAssignment:u,onShiftChange:y}){return e.jsxs("div",{className:"min-w-[800px]",children:[e.jsxs("div",{className:"flex border-b border-border bg-muted/20 sticky top-0 z-20",children:[e.jsx("div",{className:"text-left p-3 font-medium text-muted-foreground sticky left-0 bg-card z-10 min-w-[200px] w-[200px] flex-shrink-0",children:"Employee"}),i.map(m=>e.jsxs("div",{className:C("p-3 text-center min-w-[80px] flex-1",Me(new Date(m))&&"bg-primary/5"),children:[e.jsx("div",{className:"font-medium",children:j(new Date(m),"EEE")}),e.jsx("div",{className:C("text-sm",Me(new Date(m))?"text-primary font-semibold":"text-muted-foreground"),children:j(new Date(m),"d")})]},m))]}),e.jsx("div",{className:"max-h-[calc(100vh-280px)] overflow-y-auto",children:n.map(m=>e.jsxs("div",{className:C("flex border-b border-border/50",m.role==="PM"&&"bg-amber-50 dark:bg-amber-950/30",m.role==="PS"&&"bg-emerald-50 dark:bg-emerald-950/30",m.role==="SrEng"&&"bg-lime-50 dark:bg-lime-950/20"),children:[e.jsx("div",{className:C("p-3 sticky left-0 z-10 border-r border-border/50 min-w-[200px] w-[200px] flex-shrink-0 flex items-center",m.role==="PM"?"bg-amber-50 dark:bg-amber-950/30":m.role==="PS"?"bg-emerald-50 dark:bg-emerald-950/30":m.role==="SrEng"?"bg-lime-50 dark:bg-lime-950/20":"bg-card"),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center text-xs font-mono font-bold text-primary",children:m.initials}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:m.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:m.department.replace("S/","")})]})]})}),i.map(o=>{const t=u(o,m.id)||"-";return e.jsxs("div",{className:C("p-2 flex-1 flex items-center justify-center min-w-[80px]",Me(new Date(o))&&"bg-primary/5"),children:[e.jsx("span",{className:"print-only font-mono text-xs font-medium",children:t}),e.jsx("span",{className:"screen-only",children:e.jsx(os,{value:t,onValueChange:D=>y(o,m.id,D),compact:!0,"data-testid":`select-shift-${m.id}-${o}`})})]},o)})]},m.id))})]})}),Rt=d.memo(function({employees:n,monthDays:i,getAssignment:u,onShiftChange:y}){const[m,o]=d.useState(null);return e.jsxs("div",{className:"min-w-[1200px]",children:[e.jsxs("div",{className:"flex border-b border-border bg-muted/20 sticky top-0 z-20",children:[e.jsx("div",{className:"text-left p-2 font-medium text-muted-foreground sticky left-0 bg-card z-10 min-w-[180px] w-[180px] flex-shrink-0 text-xs",children:"Employee"}),i.map(t=>{const D=j(t,"yyyy-MM-dd"),P=[0,6].includes(ds(t));return e.jsxs("div",{className:C("p-1 text-center min-w-[32px] flex-1 text-xs",P&&"bg-muted/50",Me(t)&&"bg-primary/10"),children:[e.jsx("div",{className:"font-medium",children:j(t,"EEE")[0]}),e.jsx("div",{className:C("text-[10px]",Me(t)?"text-primary font-bold":"text-muted-foreground"),children:j(t,"d")})]},D)})]}),e.jsx("div",{className:"max-h-[calc(100vh-280px)] overflow-y-auto",children:n.map(t=>e.jsxs("div",{className:C("flex border-b border-border/50",t.role==="PM"&&"bg-amber-50/50",t.role==="PS"&&"bg-emerald-50/50",t.role==="SrEng"&&"bg-lime-50/50"),children:[e.jsx("div",{className:C("p-2 sticky left-0 z-10 border-r border-border/50 text-xs min-w-[180px] w-[180px] flex-shrink-0 flex items-center",t.role==="PM"?"bg-amber-50":t.role==="PS"?"bg-emerald-50":t.role==="SrEng"?"bg-lime-50":"bg-card"),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-mono font-bold text-primary text-[10px]",children:t.initials}),e.jsx("span",{className:"font-medium truncate max-w-[120px]",children:t.name.split(",")[0]})]})}),i.map(D=>{const P=j(D,"yyyy-MM-dd"),R=u(P,t.id)||"-",pe=[0,6].includes(ds(D)),F=`${t.id}-${P}`;return e.jsxs("div",{className:C("p-0.5 flex-1 flex items-center justify-center min-w-[32px]",pe&&"bg-muted/30",Me(D)&&"bg-primary/5"),children:[e.jsx("span",{className:"print-only font-mono text-[9px] font-medium",children:R}),e.jsx("span",{className:"screen-only",children:e.jsxs(Fs,{open:m===F,onOpenChange:xe=>o(xe?F:null),children:[e.jsx($s,{asChild:!0,children:e.jsx("button",{className:"cursor-pointer hover:scale-110 transition-transform",children:e.jsx(oe,{code:R,size:"xs"})})}),e.jsx(Vs,{className:"w-48 p-2",align:"center",children:e.jsx(os,{value:R,onValueChange:xe=>{y(P,t.id,xe),o(null)},"data-testid":`select-shift-month-${t.id}-${P}`})})]})})]},P)})]},t.id))})]})}),Ls=216,te=216,K=6,Y=2,rs=30,_e=35;function Kt(){const{employees:r,assignments:n,selectedDate:i,setSelectedDate:u,updateAssignment:y,getAssignment:m,getWeekDates:o,importMetadata:t}=Ps(),[D,P]=d.useState("week"),[R,pe]=d.useState("all"),[F,xe]=d.useState(i),[xs,ms]=d.useState(!1),[Be,ke]=d.useState(""),[N]=ot(Be,150),[v,q]=d.useState(null),[O,Ie]=d.useState(1),[B,Le]=d.useState("V"),[Z,hs]=d.useState(i),[le,Ee]=d.useState(7),[ge,me]=d.useState(!1),[Pe,Xe]=d.useState(!1);j(F,"yyyy-MM-dd");const je=[{code:"V",label:"Vacation (V)"},{code:"-",label:"Day Off (-)"},{code:"S",label:"Sick (S)"},{code:"KO",label:"Komp. Overtime (KO)"},{code:"FL",label:"Komp. Flextime (FL)"},{code:"UL",label:"Unpaid Leave (UL)"},{code:"MC",label:"Military (MC)"},{code:"TR",label:"Training (TR)"}],Qe=s=>{v&&y(s,v,B)},M=()=>{!v||!p.results||p.results.forEach(s=>{s.result.canGrant&&y(s.dateStr,v,B)})},G=d.useMemo(()=>{if(!N.trim())return[];const s=N.toLowerCase().trim();return r.filter(a=>a.name.toLowerCase().includes(s)||a.initials.toLowerCase().includes(s)).slice(0,8)},[r,N]),b=d.useMemo(()=>v?r.find(s=>s.id===v):null,[r,v]),f=d.useMemo(()=>{const s=["THRU","MELM","YCCR","TIMJ","HUAB","YYRJ","MECU","LECN","LCLE","HUDM","ARUZ","KRZE","LSIE","AAUL","WINY","SOER","ERIZ","BHAE","DALL","GBRU","LUPR","RREN","GNET","TOKR","COSM","FILM","PAAO","LUCP","MF","NATS","MZIM","TIML","OLCR","WEZE","JAWE","KRAF","RUAC","SAEF","LABB","RDAR","ARNG","MCOS","THNA","JUTI","GERO","MURB","BOGO","EGGL","RULO","RPAS","DMIA","ENRL","ATET_1","BOEO","DEOM","PKRI"];return[...R==="all"?r:r.filter(c=>c.department===R)].sort((c,k)=>{const _=s.indexOf(c.initials),U=s.indexOf(k.initials);return _===-1&&U===-1?0:_===-1?1:U===-1?-1:_-U})},[r,R]),W=d.useMemo(()=>o(i),[i,o]),J=d.useMemo(()=>{const s=Mt(i),a=Ct(i);return st({start:s,end:a})},[i]),$=j(i,"yyyy-MM-dd"),H=d.useMemo(()=>Ss(r,n,$),[r,n,$]);d.useMemo(()=>tt(r,n,W),[r,n,W]);const he=d.useMemo(()=>{const s=$,a=n.filter(A=>A.date===s),c=a.filter(A=>ee(A.shiftCode)).length,k=a.filter(A=>["Ea","e","Ae"].includes(A.shiftCode)).length,_=a.filter(A=>["La","l","LA","AL"].includes(A.shiftCode)).length,U=a.filter(A=>!ee(A.shiftCode)).length;return{onDuty:c,earlyShifts:k,lateShifts:_,offDuty:U}},[n,$]),Te=[{code:"TR",label:"Training",color:"bg-purple-500"},{code:"SI",label:"School Internal",color:"bg-blue-500"},{code:"SE",label:"School External",color:"bg-indigo-500"},{code:"Sn",label:"School Night",color:"bg-violet-500"},{code:"ET",label:"Educational Trip",color:"bg-cyan-500"},{code:"T",label:"Training (Off)",color:"bg-purple-400"}],us=d.useMemo(()=>{const s=[];for(let a=0;a<le;a++)s.push(j(Ce(Z,a),"yyyy-MM-dd"));return s},[Z,le]),be=d.useMemo(()=>{const s=Te.map(k=>k.code);return n.filter(k=>us.includes(k.date)&&s.includes(k.shiftCode)).map(k=>{const _=r.find(A=>A.id===k.employeeId),U=Te.find(A=>A.code===k.shiftCode);return _?{..._,educationType:k.shiftCode,educationLabel:U?.label,educationColor:U?.color,educationDate:k.date}:null}).filter(Boolean)},[n,r,us]),Re=d.useMemo(()=>{const s=n.filter(c=>c.shiftCode==="FT"),a={};return s.forEach(c=>{a[c.employeeId]||(a[c.employeeId]={dates:[]}),a[c.employeeId].dates.push(c.date)}),r.map(c=>({...c,ftCount:a[c.id]?.dates.length||0,ftDates:(a[c.id]?.dates||[]).sort()})).sort((c,k)=>k.ftCount-c.ftCount)},[n,r]),X=s=>{const a=s.skills.map(c=>c.license).filter(Boolean);return a.includes("B1/2")?"B1-2":a.includes("B1")?"B1":a.includes("B2")?"B2":a.includes("A")?"Cat A":a.includes("C")?"C":"None"},p=d.useMemo(()=>{const s=[];for(let g=0;g<O;g++)s.push(j(Ce(F,g),"yyyy-MM-dd"));const a=g=>{const l=n.filter(x=>x.date===g),h=Ss(r,n,g),V=l.filter(x=>ee(x.shiftCode)).length,Fe=l.filter(x=>!ee(x.shiftCode)).length,ss=l.filter(x=>x.shiftCode==="V").length,De=l.filter(x=>["S","IW","IC","AC","AW"].includes(x.shiftCode)).length,ue=l.filter(x=>r.find(I=>I.id===x.employeeId)?.role==="SrEng"&&ee(x.shiftCode)).length,w=l.filter(x=>r.find(I=>I.id===x.employeeId)?.role==="PS"&&ee(x.shiftCode)).length,fe=l.filter(x=>{const E=r.find(Q=>Q.id===x.employeeId);if(!E)return!1;const I=X(E);return(I==="B1"||I==="B1-2")&&ee(x.shiftCode)}),js=l.filter(x=>{const E=r.find(Q=>Q.id===x.employeeId);if(!E)return!1;const I=X(E);return(I==="B2"||I==="B1-2")&&ee(x.shiftCode)}),z=l.filter(x=>{const E=r.find(Q=>Q.id===x.employeeId);return E?X(E)==="Cat A"&&ee(x.shiftCode):!1}),bs=r.filter(x=>{const E=X(x);return E==="B1"||E==="B1-2"}).length,ys=r.filter(x=>{const E=X(x);return E==="B2"||E==="B1-2"}).length,Ns=r.filter(x=>X(x)==="Cat A").length;let $e=0;r.forEach(x=>{x.role!=="PM"&&x.role!=="PS"&&($e+=8*(x.grade/100))});const Ve=$e>0?te/$e:1,Us=Math.ceil(bs*Ve),Hs=Math.ceil(ys*Ve),zs=Math.ceil(Ns*Ve),Ks=[0,6].includes(ds(new Date(g))),Ys=new Date(g),vs=it(Ys)%2===0,qs=l.filter(x=>{const E=r.find(Zs=>Zs.id===x.employeeId);if(!E)return!1;const I=E.role?.toUpperCase()||"";if(I==="PM"||I==="PS"||I==="SE")return!1;const Q=x.shiftCode;return vs?Q==="Ea"||Q==="e":Q==="La"}).length;return{dateStr:g,currentManhours:h,onDutyCount:V,offDutyCount:Fe,vacationCount:ss,sickCount:De,seOnDuty:ue,psOnDuty:w,b1OnDuty:fe.length,b2OnDuty:js.length,catAOnDuty:z.length,totalB1:bs,totalB2:ys,totalCatA:Ns,minB1Required:Us,minB2Required:Hs,minCatARequired:zs,totalPotentialManhours:$e,requiredPercentage:Ve,isWeekend:Ks,dailyTargetCount:qs,isEaWeek:vs}},c=s.map(a),k=(g,l)=>{const h=[];let V=!0;if(l.isWeekend&&h.push({type:"yes",text:"Weekend - reduced staffing requirements"}),g){const Fe=g.grade===0;if(g.role==="PS"){const w=l.psOnDuty-1;w>=Y?h.push({type:"yes",text:`PS coverage OK: ${w} PS remain after granting (min ${Y})`}):(h.push({type:"no",text:`PS coverage insufficient: only ${w} PS after granting (need ${Y})`}),V=!1)}if(g.role==="SrEng"){const w=l.seOnDuty-1;w>=K?h.push({type:"yes",text:`SE coverage OK: ${w} SE remain after granting (min ${K})`}):(h.push({type:"no",text:`SE coverage insufficient: only ${w} SE after granting (need ${K})`}),V=!1)}const ss=8*(g.grade/100),De=l.currentManhours-ss;if(Fe?h.push({type:"yes",text:`${g.initials} has 0% grade - no manhours impact`}):De>=te?h.push({type:"yes",text:`Manhours OK: ${De.toFixed(1)}h after granting (min ${te}h)`}):(h.push({type:"no",text:`Manhours insufficient: ${De.toFixed(1)}h after granting (need ${te}h)`}),V=!1),!Fe&&g.role!=="PM"&&g.role!=="PS"){const fe=n.find(z=>z.date===l.dateStr&&z.employeeId===g.id)?.shiftCode||"-";if(l.isEaWeek?fe==="Ea"||fe==="e":fe==="La"){const z=l.dailyTargetCount-1;z<rs?(h.push({type:"no",text:`Daily Target would drop to ${z} (min ${rs} required)`}),V=!1):z<_e?h.push({type:"info",text:`⚠️ WARNING: Daily Target will drop to ${z} (orange zone, ${_e}+ preferred)`}):h.push({type:"yes",text:`Daily Target OK: ${z} after granting (≥${_e})`})}else h.push({type:"yes",text:`Employee not on ${l.isEaWeek?"Ea":"La"} shift - no daily target impact`})}const ue=X(g);if(ue==="B1"||ue==="B1-2"){const w=l.b1OnDuty-1;w>=l.minB1Required?h.push({type:"yes",text:`B1 coverage OK: ${w} on duty after granting (min ${l.minB1Required})`}):(h.push({type:"no",text:`B1 coverage low: ${w} after granting (min ${l.minB1Required})`}),V=!1)}if(ue==="B2"||ue==="B1-2"){const w=l.b2OnDuty-1;w>=l.minB2Required?h.push({type:"yes",text:`B2 coverage OK: ${w} on duty after granting (min ${l.minB2Required})`}):(h.push({type:"no",text:`B2 coverage low: ${w} after granting (min ${l.minB2Required})`}),V=!1)}if(ue==="Cat A"){const w=l.catAOnDuty-1,fe=g.grade<=50?.5:1;w>=l.minCatARequired?h.push({type:"yes",text:`Cat A coverage OK: ${w} on duty after granting (min ${l.minCatARequired})`}):h.push({type:"info",text:`Cat A at ${w} after granting (min ${l.minCatARequired}), grade ${g.grade}% = ${fe*100}% factor`})}}else l.currentManhours>=te?h.push({type:"yes",text:`Current manhours: ${l.currentManhours.toFixed(1)}h (min ${te}h)`}):(h.push({type:"no",text:`Current manhours: ${l.currentManhours.toFixed(1)}h (need ${te}h)`}),V=!1),l.seOnDuty>=K?h.push({type:"yes",text:`SE on duty: ${l.seOnDuty} (min ${K})`}):(h.push({type:"no",text:`SE on duty: ${l.seOnDuty} (need ${K})`}),V=!1),l.psOnDuty>=Y?h.push({type:"yes",text:`PS on duty: ${l.psOnDuty} (min ${Y})`}):(h.push({type:"no",text:`PS on duty: ${l.psOnDuty} (need ${Y})`}),V=!1),h.push({type:"info",text:`B1: ${l.b1OnDuty}/${l.minB1Required} min | B2: ${l.b2OnDuty}/${l.minB2Required} min | Cat A: ${l.catAOnDuty}/${l.minCatARequired} min`}),l.dailyTargetCount<rs?h.push({type:"no",text:`Daily Target: ${l.dailyTargetCount} (${l.isEaWeek?"Ea":"La"} week) - RED ZONE, no off-days should be granted`}):l.dailyTargetCount<_e?h.push({type:"info",text:`⚠️ Daily Target: ${l.dailyTargetCount} (${l.isEaWeek?"Ea":"La"} week) - ORANGE ZONE`}):h.push({type:"yes",text:`Daily Target: ${l.dailyTargetCount} (${l.isEaWeek?"Ea":"La"} week) - GREEN ZONE`});return{canGrant:V,reasons:h,empSpecific:!!g}},_=c.map(g=>({...g,result:k(b??null,g)})),U=_.every(g=>g.result.canGrant),A=Math.max(0,(c[0]?.seOnDuty||0)-K),_s=Math.max(0,(c[0]?.psOnDuty||0)-Y);return{canGrant:U,results:_,message:U?O>1?`OFF DAY CAN BE GRANTED (${O} days)`:"OFF DAY CAN BE GRANTED":"OFF DAY CANNOT BE GRANTED",stats:c[0]||{},positionVacation:{seCanTake:A,psCanTake:_s,seOnDuty:c[0]?.seOnDuty||0,psOnDuty:c[0]?.psOnDuty||0}}},[F,O,n,r,b]),fs=d.useCallback(s=>{d.startTransition(()=>{u(Ce(i,s==="prev"?-1:1))})},[i,u]),ps=d.useCallback(s=>{d.startTransition(()=>{u(s==="prev"?Et(i):Ws(i,1))})},[i,u]),gs=d.useCallback(s=>{d.startTransition(()=>{u(s==="prev"?kt(i):Gs(i,1))})},[i,u]),es=d.useCallback((s,a,c)=>{y(s,a,c)},[y]);return e.jsxs("div",{className:"p-6 lg:p-8 space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl lg:text-3xl font-display font-bold tracking-tight",children:"Schedule"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage daily shift assignments for TMBA teams"})]}),e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx(ht,{value:D,onValueChange:s=>P(s),children:e.jsxs(ut,{children:[e.jsx(as,{value:"day","data-testid":"tab-day-view",children:"Day"}),e.jsx(as,{value:"week","data-testid":"tab-week-view",children:"Week"}),e.jsx(as,{value:"month","data-testid":"tab-month-view",children:"Month"})]})}),e.jsxs(T,{variant:"outline",className:"gap-2",onClick:()=>window.print(),"data-testid":"button-print",children:[e.jsx(ft,{className:"w-4 h-4"}),"Print / PDF"]}),e.jsx(Tt,{}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(T,{variant:"outline",className:"gap-2","data-testid":"button-check-off-day",children:[e.jsx(ye,{className:"w-4 h-4"}),"Check Off Day"]})}),e.jsxs(ze,{className:"max-w-5xl max-h-[90vh] p-0",children:[e.jsx(Ke,{className:"px-6 pt-6 pb-4 border-b",children:e.jsx(Ye,{className:"text-xl",children:"Off Day Availability Check"})}),e.jsxs("div",{className:"flex flex-col lg:flex-row",children:[e.jsxs("div",{className:"lg:w-[340px] border-b lg:border-b-0 lg:border-r p-4 bg-muted/30 space-y-4",children:[e.jsxs("div",{children:[e.jsx(Ne,{className:"text-sm font-medium mb-2 block",children:"Search Employee (name or code)"}),e.jsxs("div",{className:"relative",children:[e.jsx(xt,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx(Cs,{placeholder:"e.g. THRU or Thurner",value:Be,onChange:s=>ke(s.target.value),className:"pl-9","data-testid":"input-employee-search"})]}),G.length>0&&e.jsx("div",{className:"mt-2 border rounded-md bg-background max-h-48 overflow-y-auto",children:G.map(s=>e.jsxs("button",{onClick:()=>{q(s.id),ke("")},className:"w-full px-3 py-2 text-left hover:bg-muted flex items-center gap-2 text-sm","data-testid":`employee-option-${s.initials}`,children:[e.jsx(Es,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:s.initials}),e.jsx("span",{className:"text-muted-foreground",children:s.name}),e.jsx(L,{variant:"outline",className:"ml-auto text-xs",children:X(s)})]},s.id))}),b&&e.jsxs("div",{className:"mt-2 p-3 rounded-lg bg-primary/10 border border-primary/20",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Es,{className:"w-5 h-5 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:b.initials}),e.jsx("p",{className:"text-xs text-muted-foreground",children:b.name})]})]}),e.jsx(T,{variant:"ghost",size:"sm",onClick:()=>q(null),className:"h-6 px-2",children:"Clear"})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-1",children:[e.jsx(L,{variant:"secondary",children:X(b)}),e.jsx(L,{variant:"outline",children:b.role}),e.jsxs(L,{variant:"outline",children:[b.grade,"% grade"]})]})]})]}),e.jsxs("div",{children:[e.jsx(Ne,{className:"text-sm font-medium mb-2 block",children:"Days to Check"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(ne,{value:O.toString(),onValueChange:s=>Ie(parseInt(s)),children:[e.jsx(ae,{className:"w-24","data-testid":"select-days-to-check",children:e.jsx(ie,{})}),e.jsx(re,{children:[1,2,3,4,5,6,7,8,9,10].map(s=>e.jsxs(S,{value:s.toString(),children:[s," day",s>1?"s":""]},s))})]}),e.jsx("div",{className:"flex-1",children:e.jsx(Cs,{type:"number",min:"1",max:"365",value:O,onChange:s=>Ie(Math.max(1,Math.min(365,parseInt(s.target.value)||1))),placeholder:"Custom",className:"w-full","data-testid":"input-days-custom"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:O===1?"Single day":`${O} consecutive days`})]}),e.jsxs("div",{children:[e.jsx(Ne,{className:"text-sm font-medium mb-2 block",children:"Start Date"}),e.jsx(Ms,{mode:"single",selected:F,onSelect:s=>s&&xe(s),weekStartsOn:1,className:"rounded-md border mx-auto","data-testid":"calendar-off-day-date"})]}),e.jsxs("div",{className:"text-center p-2 bg-background rounded border",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Checking:"}),e.jsxs("p",{className:"text-sm font-bold",children:[j(F,"MMM d"),O>1&&` - ${j(Ce(F,O-1),"MMM d, yyyy")}`,O===1&&`, ${j(F,"yyyy")}`]})]}),b&&e.jsxs("div",{children:[e.jsx(Ne,{className:"text-sm font-medium mb-2 block",children:"Off Day Type"}),e.jsxs(ne,{value:B,onValueChange:s=>Le(s),children:[e.jsx(ae,{"data-testid":"select-off-day-type",children:e.jsx(ie,{})}),e.jsx(re,{children:je.map(s=>e.jsx(S,{value:s.code,children:s.label},s.code))})]})]})]}),e.jsx(Ae,{className:"flex-1 max-h-[60vh] lg:max-h-[70vh]",children:e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs(se,{className:C("p-4",p.canGrant?"bg-green-50 border-green-200 dark:bg-green-950/30 dark:border-green-800":"bg-red-50 border-red-200 dark:bg-red-950/30 dark:border-red-800"),children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[p.canGrant?e.jsx(ye,{className:"w-8 h-8 text-green-600"}):e.jsx(Oe,{className:"w-8 h-8 text-red-600"}),e.jsxs("div",{children:[e.jsx("span",{className:C("font-bold text-lg block",p.canGrant?"text-green-700 dark:text-green-400":"text-red-700 dark:text-red-400"),children:p.message}),b&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:["for ",b.initials," (",b.name,")"]})]})]}),p.positionVacation&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-semibold mb-2",children:"Position Availability:"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[(()=>{const s=b?.role==="SrEng",a=s?p.positionVacation.seOnDuty-1:p.positionVacation.seOnDuty,c=s?a>=K:p.positionVacation.seCanTake>0;return e.jsxs("div",{className:C("rounded-lg p-3 border",c?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:"SE"}),c?e.jsx(ye,{className:"w-5 h-5 text-green-600"}):e.jsx(Oe,{className:"w-5 h-5 text-red-600"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:p.positionVacation.seCanTake}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"can take off"}),e.jsxs("div",{className:"text-xs mt-1",children:["(",p.positionVacation.seOnDuty," on duty, min ",K,")"]})]})})(),(()=>{const s=b?.role==="PS",a=s?p.positionVacation.psOnDuty-1:p.positionVacation.psOnDuty,c=s?a>=Y:p.positionVacation.psCanTake>0;return e.jsxs("div",{className:C("rounded-lg p-3 border",c?"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800":"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-semibold",children:"PS"}),c?e.jsx(ye,{className:"w-5 h-5 text-green-600"}):e.jsx(Oe,{className:"w-5 h-5 text-red-600"})]}),e.jsx("div",{className:"text-2xl font-bold mt-1",children:p.positionVacation.psCanTake}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"can take off"}),e.jsxs("div",{className:"text-xs mt-1",children:["(",p.positionVacation.psOnDuty," on duty, min ",Y,")"]})]})})()]})]}),p.stats&&e.jsxs("div",{className:"grid grid-cols-5 gap-2 mb-4 text-sm",children:[e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:p.stats.currentManhours?.toFixed(0)||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Manhours"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:p.stats.b1OnDuty||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"B1"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:p.stats.b2OnDuty||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"B2"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:p.stats.catAOnDuty||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Cat A"})]}),e.jsxs("div",{className:"bg-white/70 dark:bg-black/20 rounded p-2 text-center",children:[e.jsx("div",{className:"font-bold text-lg",children:p.stats.sickCount||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Sick"})]})]})]}),p.results?.map((s,a)=>e.jsxs(se,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[s.result.canGrant?e.jsx(ye,{className:"w-5 h-5 text-green-600"}):e.jsx(Oe,{className:"w-5 h-5 text-red-600"}),e.jsx("span",{className:"font-semibold",children:j(new Date(s.dateStr),"EEE, MMM d")}),e.jsx(L,{variant:s.result.canGrant?"default":"destructive",children:s.result.canGrant?"OK":"NO"}),b&&s.result.canGrant&&e.jsxs(T,{size:"sm",className:"ml-auto",onClick:()=>Qe(s.dateStr),"data-testid":`apply-off-day-${a}`,children:["Apply ",B]})]}),e.jsx("div",{className:"space-y-1",children:s.result.reasons.map((c,k)=>e.jsxs("div",{className:C("flex items-start gap-2 text-sm p-2 rounded",c.type==="yes"?"bg-green-100/50 dark:bg-green-900/20":c.type==="no"?"bg-red-100/50 dark:bg-red-900/20":"bg-blue-100/50 dark:bg-blue-900/20"),children:[c.type==="yes"?e.jsx(ye,{className:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5"}):c.type==="no"?e.jsx(Oe,{className:"w-4 h-4 text-red-600 flex-shrink-0 mt-0.5"}):e.jsx(is,{className:"w-4 h-4 text-blue-600 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:c.type==="yes"?"text-green-700 dark:text-green-400":c.type==="no"?"text-red-700 dark:text-red-400":"text-blue-700 dark:text-blue-400",children:c.text})]},k))})]},a)),b&&p.canGrant&&p.results&&p.results.length>1&&e.jsxs(T,{className:"w-full",onClick:M,"data-testid":"apply-all-off-days",children:["Apply ",B," to All ",p.results.filter(s=>s.result.canGrant).length," Approved Days"]}),e.jsxs("div",{className:"text-xs text-muted-foreground bg-muted/50 p-3 rounded",children:[e.jsx("p",{className:"font-semibold mb-1",children:"Off Day Rules:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-0.5",children:[e.jsxs("li",{children:["Minimum ",te," manhours must remain"]}),e.jsxs("li",{children:["Minimum ",K," SE must remain on duty"]}),e.jsxs("li",{children:["Minimum ",Y," PS must remain on duty"]}),e.jsxs("li",{children:["B1/B2/Cat A coverage based on % of ",te,"h vs total potential"]}),e.jsx("li",{children:"Grade 0% employees can always take off"}),e.jsx("li",{children:"B1-2 license counts toward both B1 and B2"})]})]})]})})]})]})]}),e.jsxs(Ue,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",className:"gap-2","data-testid":"button-training-view",children:[e.jsx(cs,{className:"w-4 h-4"}),"Education",be.length>0&&e.jsx(L,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:be.length})]})}),e.jsxs(ze,{className:"max-w-2xl max-h-[85vh] p-0",children:[e.jsx(Ke,{className:"px-6 pt-6 pb-4 border-b",children:e.jsxs(Ye,{className:"flex items-center gap-2",children:[e.jsx(cs,{className:"w-5 h-5"}),"Training & Education Overview"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-end gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ne,{className:"text-xs",children:"Start Date"}),e.jsxs(Fs,{open:ge,onOpenChange:me,children:[e.jsx($s,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",className:"w-[160px] justify-start text-left font-normal",children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),j(Z,"MMM d, yyyy")]})}),e.jsx(Vs,{className:"w-auto p-0",align:"start",children:e.jsx(Ms,{mode:"single",selected:Z,onSelect:s=>{s&&(hs(s),me(!1))},weekStartsOn:1,initialFocus:!0})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(Ne,{className:"text-xs",children:"Period"}),e.jsxs(ne,{value:String(le),onValueChange:s=>Ee(Number(s)),children:[e.jsx(ae,{className:"w-[120px]",children:e.jsx(ie,{})}),e.jsxs(re,{children:[e.jsx(S,{value:"1",children:"1 day"}),e.jsx(S,{value:"7",children:"7 days"}),e.jsx(S,{value:"14",children:"14 days"}),e.jsx(S,{value:"30",children:"30 days"})]})]})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[j(Z,"MMM d")," - ",j(Ce(Z,le-1),"MMM d, yyyy")]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Te.map(s=>e.jsxs("div",{className:"flex items-center gap-1.5 text-xs px-2 py-1 bg-muted rounded",children:[e.jsx("span",{className:C("w-2.5 h-2.5 rounded-full",s.color)}),e.jsx("span",{className:"font-medium",children:s.code}),e.jsxs("span",{className:"text-muted-foreground",children:["- ",s.label]})]},s.code))}),be.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No employees in training/school during this period"}):e.jsx(Ae,{className:"h-[350px] border rounded-lg",children:e.jsxs(Ds,{children:[e.jsx(Os,{children:e.jsxs(We,{children:[e.jsx(ce,{children:"Employee"}),e.jsx(ce,{children:"Department"}),e.jsx(ce,{children:"Date"}),e.jsx(ce,{children:"Type"})]})}),e.jsx(As,{children:be.map((s,a)=>e.jsxs(We,{children:[e.jsx(de,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-primary/10 flex items-center justify-center text-xs font-bold",children:s.initials}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx(de,{className:"text-muted-foreground",children:s.department.replace("S/","")}),e.jsx(de,{children:j(new Date(s.educationDate),"EEE, MMM d")}),e.jsx(de,{children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:C("w-2 h-2 rounded-full",s.educationColor)}),e.jsx(L,{variant:"outline",className:"text-xs",children:s.educationType})]})})]},`${s.id}-${s.educationDate}-${a}`))})]})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground pt-2 border-t",children:[e.jsxs("span",{children:["Total: ",be.length," education entries"]}),e.jsxs("span",{children:[new Set(be.map(s=>s.id)).size," unique employees"]})]})]})]})]}),e.jsxs(Ue,{open:Pe,onOpenChange:Xe,children:[e.jsx(He,{asChild:!0,children:e.jsxs(T,{variant:"outline",size:"sm",className:"gap-2","data-testid":"button-ft-summary",children:[e.jsx(Ge,{className:"w-4 h-4"}),"FT Summary",e.jsx(L,{variant:"secondary",className:"ml-1 h-5 px-1.5 text-xs",children:Re.reduce((s,a)=>s+a.ftCount,0)})]})}),e.jsxs(ze,{className:"max-w-3xl max-h-[85vh] p-0",children:[e.jsx(Ke,{className:"px-6 pt-6 pb-4 border-b",children:e.jsxs(Ye,{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5"}),"FT (Feiertag/Holiday) Summary"]})}),e.jsxs("div",{className:"p-6",children:[e.jsx(Ae,{className:"h-[500px] border rounded-lg",children:e.jsxs(Ds,{children:[e.jsx(Os,{children:e.jsxs(We,{children:[e.jsx(ce,{children:"Employee"}),e.jsx(ce,{children:"Department"}),e.jsx(ce,{className:"text-center",children:"FT Count"}),e.jsx(ce,{children:"Dates"})]})}),e.jsx(As,{children:Re.map(s=>e.jsxs(We,{children:[e.jsx(de,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-amber-100 text-amber-700 flex items-center justify-center text-xs font-bold",children:s.initials}),e.jsx("span",{className:"font-medium",children:s.name})]})}),e.jsx(de,{className:"text-muted-foreground",children:s.department.replace("S/","")}),e.jsx(de,{className:"text-center",children:e.jsx(L,{variant:s.ftCount>0?"default":"secondary",className:"min-w-[32px]",children:s.ftCount})}),e.jsx(de,{children:s.ftCount>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.ftDates.slice(0,5).map(a=>e.jsx(L,{variant:"outline",className:"text-xs",children:j(new Date(a),"MMM d")},a)),s.ftDates.length>5&&e.jsxs(L,{variant:"outline",className:"text-xs text-muted-foreground",children:["+",s.ftDates.length-5," more"]})]}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"-"})})]},s.id))})]})}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-muted-foreground pt-4 border-t mt-4",children:[e.jsxs("span",{children:["Total FT days: ",Re.reduce((s,a)=>s+a.ftCount,0)]}),e.jsxs("span",{children:[Re.filter(s=>s.ftCount>0).length," employees with FT"]})]})]})]})]}),e.jsxs(ne,{value:R,onValueChange:pe,children:[e.jsx(ae,{className:"w-[140px]","data-testid":"select-department-filter",children:e.jsx(ie,{placeholder:"Department"})}),e.jsxs(re,{children:[e.jsx(S,{value:"all",children:"All Teams"}),e.jsx(S,{value:"S/TMBA",children:"TMBA"}),e.jsx(S,{value:"S/TMBAA",children:"TMBAA"}),e.jsx(S,{value:"S/TMBAB",children:"TMBAB"}),e.jsx(S,{value:"S/TMBAC",children:"TMBAC"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(se,{className:"p-4 bg-card border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-primary/10 flex items-center justify-center",children:e.jsx(Rs,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Daily Hours"}),e.jsx("p",{className:C("text-xl font-display font-bold",H<Ls?"text-red-500":"text-green-500"),children:H.toFixed(1)})]})]})}),e.jsx(se,{className:"p-4 bg-card border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-success/10 flex items-center justify-center",children:e.jsx(nt,{className:"w-5 h-5 text-success"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Daily Target"}),e.jsxs("p",{className:"text-xl font-display font-bold",children:[Ls,"h"]})]})]})}),e.jsx(se,{className:"p-4 bg-card border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-warning/10 flex items-center justify-center",children:e.jsx(at,{className:"w-5 h-5 text-warning"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"On Duty"}),e.jsx("p",{className:"text-xl font-display font-bold",children:he.onDuty})]})]})}),e.jsx(se,{className:"p-4 bg-card border-border",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg bg-accent flex items-center justify-center",children:e.jsx(Ge,{className:"w-5 h-5 text-accent-foreground"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Off Duty"}),e.jsx("p",{className:"text-xl font-display font-bold",children:he.offDuty})]})]})})]}),t&&e.jsxs("div",{className:"flex items-center gap-4 px-3 py-2 bg-muted/50 rounded-lg text-xs text-muted-foreground border","data-testid":"import-metadata-info",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Data Source:"}),e.jsxs("span",{children:["Imported ",j(new Date(t.importedAt),"MMM d, yyyy HH:mm")]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[t.employeeCount," employees"]}),e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:[t.assignmentCount.toLocaleString()," assignments"]}),t.dateRange&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-border",children:"|"}),e.jsxs("span",{children:["Range: ",j(new Date(t.dateRange.start),"MMM d")," - ",j(new Date(t.dateRange.end),"MMM d, yyyy")]})]})]}),D==="day"&&e.jsxs(se,{className:"overflow-hidden border-border",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between bg-muted/30",children:[e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>fs("prev"),"data-testid":"button-prev-day",children:e.jsx(ts,{className:"w-5 h-5"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"font-display font-semibold text-lg",children:j(i,"EEEE, MMMM d, yyyy")}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-1 text-sm text-muted-foreground",children:[e.jsxs("span",{children:["Early: ",he.earlyShifts]}),e.jsxs("span",{children:["Late: ",he.lateShifts]}),e.jsxs("span",{children:["Off: ",he.offDuty]})]})]}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>fs("next"),"data-testid":"button-next-day",children:e.jsx(ns,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:f.map(s=>{const a=m($,s.id)||"-";return qe.find(c=>c.code===a),e.jsxs("div",{className:C("p-3 rounded-lg border flex items-center justify-between",s.role==="PM"&&"bg-amber-50 border-amber-200",s.role==="PS"&&"bg-emerald-50 border-emerald-200",s.role==="SrEng"&&"bg-lime-50 border-lime-200",!["PM","PS","SrEng"].includes(s.role)&&"bg-card border-border"),"data-testid":`employee-card-${s.id}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center text-xs font-mono font-bold text-primary",children:s.initials}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.role," • ",s.department.replace("S/","")]})]})]}),e.jsx(os,{value:a,onValueChange:c=>es($,s.id,c),"data-testid":`select-shift-day-${s.id}`})]},s.id)})})})]}),D==="week"&&e.jsxs(se,{className:"overflow-hidden border-border",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between bg-muted/30",children:[e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>ps("prev"),"data-testid":"button-prev-week",children:e.jsx(ts,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ne,{value:String(lt(i,{weekStartsOn:1,firstWeekContainsDate:4})),onValueChange:s=>{d.startTransition(()=>{const a=mt(i,parseInt(s),{weekStartsOn:1,firstWeekContainsDate:4});u(rt(a,{weekStartsOn:1}))})},children:[e.jsx(ae,{className:"w-[100px]","data-testid":"select-week",children:e.jsx(ie,{placeholder:"Week"})}),e.jsx(re,{children:e.jsx(Ae,{className:"h-[300px]",children:Array.from({length:52},(s,a)=>a+1).map(s=>e.jsxs(S,{value:String(s),children:["Week ",s]},s))})})]}),e.jsxs(ne,{value:String(i.getFullYear()),onValueChange:s=>{d.startTransition(()=>{u(new Date(parseInt(s),i.getMonth(),i.getDate()))})},children:[e.jsx(ae,{className:"w-[90px]","data-testid":"select-week-year",children:e.jsx(ie,{})}),e.jsx(re,{children:[2024,2025,2026,2027,2028].map(s=>e.jsx(S,{value:String(s),children:s},s))})]}),e.jsxs("span",{className:"text-sm text-muted-foreground hidden sm:inline",children:[j(new Date(W[0]),"MMM d")," - ",j(new Date(W[6]),"MMM d")]})]}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>ps("next"),"data-testid":"button-next-week",children:e.jsx(ns,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Pt,{employees:f,weekDates:W,getAssignment:m,onShiftChange:es})})]}),D==="month"&&e.jsxs(se,{className:"overflow-hidden border-border",children:[e.jsxs("div",{className:"p-4 border-b border-border flex items-center justify-between bg-muted/30",children:[e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>gs("prev"),"data-testid":"button-prev-month",children:e.jsx(ts,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ne,{value:String(i.getMonth()),onValueChange:s=>{d.startTransition(()=>{u(new Date(i.getFullYear(),parseInt(s),1))})},children:[e.jsx(ae,{className:"w-[130px]","data-testid":"select-month",children:e.jsx(ie,{})}),e.jsx(re,{children:["January","February","March","April","May","June","July","August","September","October","November","December"].map((s,a)=>e.jsx(S,{value:String(a),children:s},a))})]}),e.jsxs(ne,{value:String(i.getFullYear()),onValueChange:s=>{d.startTransition(()=>{u(new Date(parseInt(s),i.getMonth(),1))})},children:[e.jsx(ae,{className:"w-[90px]","data-testid":"select-year",children:e.jsx(ie,{})}),e.jsx(re,{children:[2024,2025,2026,2027,2028].map(s=>e.jsx(S,{value:String(s),children:s},s))})]})]}),e.jsx(T,{variant:"ghost",size:"icon",onClick:()=>gs("next"),"data-testid":"button-next-month",children:e.jsx(ns,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"overflow-x-auto",children:J.length>0&&e.jsx(Rt,{employees:f,monthDays:J,getAssignment:m,onShiftChange:es})})]})]})}export{Kt as CalendarPage};
